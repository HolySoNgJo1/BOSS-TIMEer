<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px;
}
h1 { text-align:center; }

.panel {
  background:#020617;
  border:1px solid #334155;
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}

input {
  padding:6px 10px;
  border-radius:6px;
  border:none;
}

button {
  background:#2563eb;
  color:white;
  border:none;
  padding:6px 14px;
  border-radius:6px;
  cursor:pointer;
}
button:hover { background:#1d4ed8; }

table {
  width:100%;
  border-collapse:collapse;
  background:#020617;
}
th, td {
  border:1px solid #334155;
  padding:10px;
  text-align:center;
}

.manual { color:#4ade80; font-weight:bold; }
.auto { color:#fb923c; font-weight:bold; }

.warn10 { color:#facc15; font-weight:bold; }
.warn5 {
  color:#f87171;
  font-weight:bold;
  animation: blink 1s infinite;
}
@keyframes blink { 50% { opacity:0.4; } }
</style>
</head>

<body>

<h1>ğŸ¯ éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</h1>

<!-- æ–°å¢ BOSS -->
<div class="panel">
  <input id="bossName" placeholder="BOSS åç¨±">
  <input id="bossCycle" type="number" placeholder="åˆ·æ–°æ™‚é–“ï¼ˆåˆ†é˜ï¼‰">
  <button onclick="addBoss()">æ–°å¢ BOSS</button>
</div>

<table>
<thead>
<tr>
  <th>BOSS</th>
  <th>åˆ·æ–°é€±æœŸ</th>
  <th>å‰©é¤˜æ™‚é–“</th>
  <th>ä¸‹æ¬¡åˆ·æ–°ï¼ˆå°ç£æ™‚é–“ï¼‰</th>
  <th>ä¾†æº</th>
  <th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="bossTable"></tbody>
</table>

<script>
const AUTO_DELAY = 3 * 60 * 1000;

let bosses = JSON.parse(localStorage.getItem("boss_timer")) || [
  { name:"é¾ç‹", cycle:120, last:Date.now(), source:"manual" },
  { name:"é­”ç‹", cycle:180, last:Date.now(), source:"manual" }
];

function save() {
  localStorage.setItem("boss_timer", JSON.stringify(bosses));
}

function addBoss() {
  const name = bossName.value.trim();
  const cycle = parseInt(bossCycle.value);
  if (!name || !cycle) {
    alert("è«‹è¼¸å…¥ BOSS åç¨±èˆ‡åˆ·æ–°æ™‚é–“");
    return;
  }
  bosses.push({
    name,
    cycle,
    last: Date.now(),
    source: "manual"
  });
  bossName.value = "";
  bossCycle.value = "";
  save();
}

function manual(i) {
  bosses[i].last = Date.now();
  bosses[i].source = "manual";
  save();
}

function removeBoss(i) {
  if (confirm("ç¢ºå®šåˆªé™¤é€™å€‹ BOSSï¼Ÿ")) {
    bosses.splice(i,1);
    save();
  }
}

function formatRemain(ms) {
  if (ms <= 0) return "00:00";
  const m = Math.floor(ms/60000);
  const s = Math.floor(ms%60000/1000);
  let cls = "";
  if (m <= 5) cls = "warn5";
  else if (m <= 10) cls = "warn10";
  return `<span class="${cls}">${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}</span>`;
}

function formatTW(ts) {
  return new Date(ts).toLocaleTimeString("zh-TW", {
    hour:"2-digit",
    minute:"2-digit"
  });
}

function tick() {
  const now = Date.now();
  bossTable.innerHTML = "";

  bosses.forEach((b,i)=>{
    const next = b.last + b.cycle*60000;

    // âœ… ç³»çµ±è‡ªå‹•åˆ·æ–°ï¼ˆå¯ç„¡é™å¾ªç’°ï¼‰
    if (now > next + AUTO_DELAY) {
      b.last = now;
      b.source = "auto";
      save();
    }

    bossTable.innerHTML += `
    <tr>
      <td>${b.name}</td>
      <td>${b.cycle} åˆ†</td>
      <td>${formatRemain(b.last + b.cycle*60000 - now)}</td>
      <td>${formatTW(b.last + b.cycle*60000)}</td>
      <td class="${b.source}">
        ${b.source === "auto" ? "ç³»çµ±" : "æ‰‹å‹•"}
      </td>
      <td>
        <button onclick="manual(${i})">æ“Šæ®º</button>
        <button onclick="removeBoss(${i})">åˆªé™¤</button>
      </td>
    </tr>`;
  });
}

setInterval(tick,1000);
tick();
</script>

</body>
</html>
