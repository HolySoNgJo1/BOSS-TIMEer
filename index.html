<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}

h1 { text-align: center; }

.panel {
  background:#020617;
  border:1px solid #334155;
  padding:15px;
  border-radius:10px;
  margin-bottom:20px;
}

input {
  padding:6px;
  margin-right:6px;
  border-radius:6px;
  border:none;
}

button {
  background:#2563eb;
  color:white;
  border:none;
  padding:6px 14px;
  border-radius:6px;
  cursor:pointer;
}

button:hover { background:#1d4ed8; }

table {
  width:100%;
  border-collapse:collapse;
  background:#020617;
}

th, td {
  border:1px solid #334155;
  padding:10px;
  text-align:center;
}

.manual { color:#4ade80; font-weight:bold; }
.auto { color:#fb923c; font-weight:bold; }

.warn10 { color:#facc15; font-weight:bold; }
.warn5 {
  color:#f87171;
  font-weight:bold;
  animation: blink 1s infinite;
}
.ready { color:#f87171; font-weight:bold; }

@keyframes blink {
  50% { opacity:0.3; }
}
</style>
</head>

<body>

<h1>ğŸ¯ éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</h1>

<div class="panel">
  <input id="bossName" placeholder="BOSS åç¨±">
  <input id="bossCycle" type="number" placeholder="åˆ·æ–°é€±æœŸï¼ˆåˆ†é˜ï¼‰">
  <button onclick="addBoss()">æ–°å¢ BOSS</button>
</div>

<table>
<thead>
<tr>
  <th>BOSS</th>
  <th>åˆ·æ–°é€±æœŸ</th>
  <th>å€’æ•¸æ™‚é–“</th>
  <th>ä¾†æº</th>
  <th>æ“ä½œ</th>
</tr>
</thead>
<tbody id="bossTable"></tbody>
</table>

<script>
const AUTO_DELAY = 3 * 60 * 1000;

let bosses = JSON.parse(localStorage.getItem("boss_timer")) || [
  { name:"é¾ç‹", cycle:120, last:Date.now(), source:"manual" },
  { name:"é­”ç‹", cycle:180, last:Date.now(), source:"manual" },
  { name:"æ·±æ·µé ˜ä¸»", cycle:240, last:Date.now(), source:"manual" }
];

function save() {
  localStorage.setItem("boss_timer", JSON.stringify(bosses));
}

function addBoss() {
  const name = bossName.value.trim();
  const cycle = parseInt(bossCycle.value);
  if (!name || !cycle) return alert("è«‹è¼¸å…¥å®Œæ•´è³‡æ–™");
  bosses.push({ name, cycle, last:Date.now(), source:"manual" });
  bossName.value = "";
  bossCycle.value = "";
  save();
}

function removeBoss(i) {
  if (confirm("ç¢ºå®šåˆªé™¤ï¼Ÿ")) {
    bosses.splice(i,1);
    save();
  }
}

function manual(i) {
  bosses[i].last = Date.now();
  bosses[i].source = "manual";
  save();
}

function format(remain) {
  if (remain <= 0) return `<span class="ready">å·²åˆ·æ–°</span>`;
  const m = Math.floor(remain/60000);
  const s = Math.floor(remain%60000/1000);
  let cls = "";
  if (m <= 5) cls = "warn5";
  else if (m <= 10) cls = "warn10";
  return `<span class="${cls}">${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}</span>`;
}

function tick() {
  bossTable.innerHTML = "";
  bosses.forEach((b,i)=>{
    const now = Date.now();
    const remain = b.last + b.cycle*60000 - now;

    // è‡ªå‹•åˆ·æ–°åˆ¤å®š
    if (remain < -AUTO_DELAY) {
      b.last = now;  // âœ… ä¿®æ­£ï¼šç”¨ç¾åœ¨æ™‚é–“é‡æ–°è¨ˆç®—å€’æ•¸
      b.source = "auto";
      save();
    }

    bossTable.innerHTML += `
    <tr>
      <td>${b.name}</td>
      <td>${b.cycle}</td>
      <td>${format(b.last + b.cycle*60000 - now)}</td>
      <td class="${b.source}">${b.source==="auto"?"ç³»çµ±":"æ‰‹å‹•"}</td>
      <td>
        <button onclick="manual(${i})">æ“Šæ®º</button>
        <button onclick="removeBoss(${i})">åˆªé™¤</button>
      </td>
    </tr>`;
  });
}

setInterval(tick,1000);
tick();
</script>

</body>
</html>
