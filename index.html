<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  padding: 20px;
}

h1 {
  text-align: center;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #020617;
}

th, td {
  border: 1px solid #334155;
  padding: 10px;
  text-align: center;
}

th {
  background: #020617;
}

button {
  background: #2563eb;
  color: white;
  border: none;
  padding: 6px 14px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #1d4ed8;
}

.manual {
  color: #4ade80;
  font-weight: bold;
}

.auto {
  color: #fb923c;
  font-weight: bold;
}

.ready {
  color: #f87171;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>ğŸ¯ éŠæˆ²é¦–é ˜è¨ˆæ™‚å™¨</h1>

<table>
  <thead>
    <tr>
      <th>BOSS åç¨±</th>
      <th>åˆ·æ–°é€±æœŸï¼ˆåˆ†é˜ï¼‰</th>
      <th>å€’æ•¸æ™‚é–“</th>
      <th>æœ€å¾Œåˆ·æ–°ä¾†æº</th>
      <th>æ“ä½œ</th>
    </tr>
  </thead>
  <tbody id="bossTable"></tbody>
</table>

<script>
const AUTO_REFRESH_DELAY = 3 * 60 * 1000; // 3 åˆ†é˜

let bosses = JSON.parse(localStorage.getItem("boss_timer_data")) || [
  { name: "é¾ç‹", cycle: 120, lastTime: Date.now(), source: "manual" },
  { name: "é­”ç‹", cycle: 180, lastTime: Date.now(), source: "manual" },
  { name: "æ·±æ·µé ˜ä¸»", cycle: 240, lastTime: Date.now(), source: "manual" }
];

function save() {
  localStorage.setItem("boss_timer_data", JSON.stringify(bosses));
}

function manualRefresh(index) {
  bosses[index].lastTime = Date.now();
  bosses[index].source = "manual";
  save();
}

function formatTime(ms) {
  if (ms <= 0) return `<span class="ready">å·²åˆ·æ–°</span>`;
  const m = Math.floor(ms / 60000);
  const s = Math.floor((ms % 60000) / 1000);
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

function update() {
  const table = document.getElementById("bossTable");
  table.innerHTML = "";

  bosses.forEach((boss, index) => {
    const nextTime = boss.lastTime + boss.cycle * 60000;
    const now = Date.now();
    const remain = nextTime - now;

    // è‡ªå‹•åˆ·æ–°åˆ¤å®š
    if (remain < -AUTO_REFRESH_DELAY) {
      boss.lastTime = nextTime;
      boss.source = "auto";
      save();
    }

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${boss.name}</td>
      <td>${boss.cycle}</td>
      <td>${formatTime(nextTime - now)}</td>
      <td class="${boss.source}">
        ${boss.source === "auto" ? "ç³»çµ±è‡ªå‹•" : "æ‰‹å‹•"}
      </td>
      <td>
        <button onclick="manualRefresh(${index})">æ“Šæ®º / åˆ·æ–°</button>
      </td>
    `;
    table.appendChild(tr);
  });
}

setInterval(update, 1000);
update();
</script>

</body>
</html>
